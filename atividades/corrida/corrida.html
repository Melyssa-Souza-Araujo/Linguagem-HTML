<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Corrida de Carros com Apostas e Jogadores</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    font-family: 'Poppins', sans-serif;
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 40px 20px;
  }
  header {
    background: #4a90e2;
    width: 100%;
    padding: 20px 0;
    margin-bottom: 40px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }
  header h1 {
    color: #fff;
    font-weight: 600;
    text-align: center;
    margin: 0;
    font-size: 2.4rem;
    letter-spacing: 2px;
  }
  .container {
    max-width: 800px;
    width: 100%;
  }
  .controls, .jogadores, .classificacao {
    background: white;
    border-radius: 12px;
    padding: 20px 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .controls {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
  }
  label {
    font-weight: 600;
    font-size: 1.1rem;
    color: #444;
  }
  select, input[type="text"] {
    padding: 10px 15px;
    font-size: 1rem;
    border: 2px solid #4a90e2;
    border-radius: 8px;
    background: white;
    color: #333;
    cursor: pointer;
    transition: border-color 0.3s ease;
  }
  select:hover, select:focus, input[type="text"]:focus {
    border-color: #2a65c7;
    outline: none;
  }
  button {
    background: #4a90e2;
    color: white;
    border: none;
    padding: 12px 28px;
    font-size: 1.1rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.5);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  button:hover {
    background: #2a65c7;
    box-shadow: 0 6px 20px rgba(42, 101, 199, 0.7);
  }
  .pista {
    position: relative;
    width: 600px;
    height: 60px;
    margin-bottom: 30px;
    border-radius: 20px;
    background: linear-gradient(to right, #e0e7ff, #f0f4ff);
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
    overflow: visible;
    margin-left: auto;
    margin-right: auto;
  }
  .linha-chegada {
    position: absolute;
    right: 0;
    top: 0;
    width: 6px;
    height: 100%;
    background: repeating-linear-gradient(
      45deg,
      #444,
      #444 10px,
      #ddd 10px,
      #ddd 20px
    );
    box-shadow: 0 0 10px #333 inset;
  }
  .carro {
    position: absolute;
    top: 10px;
    width: 80px;
    height: 40px;
    background-color: gray;
    border-radius: 15px 15px 10px 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    transition: left 0.1s ease-out;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 5px 10px;
    box-sizing: border-box;
  }
  #vermelho {
    background-color: #ff4d4d;
    border: 2px solid #d43f3f;
  }
  #azul {
    background-color: #4d79ff;
    border: 2px solid #3f5fd4;
  }
  #verde {
    background-color: #4dff88;
    border: 2px solid #3fd473;
  }
  .janela {
    width: 30px;
    height: 20px;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 4px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
  }
  .farol {
    width: 10px;
    height: 10px;
    background: yellow;
    border-radius: 50%;
    box-shadow: 0 0 8px 2px rgba(255, 255, 0, 0.7);
  }
  .roda {
    position: absolute;
    bottom: -10px;
    width: 18px;
    height: 18px;
    background-color: #222;
    border-radius: 50%;
    box-shadow: inset 0 2px 4px rgba(255,255,255,0.3);
  }
  .roda-esq {
    left: 10px;
  }
  .roda-dir {
    right: 10px;
  }
  #resultado, #apostaResultado {
    font-size: 1.3rem;
    font-weight: 700;
    margin-top: 20px;
    text-align: center;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  #apostaResultado {
    margin-top: 8px;
  }
  /* Tabela de jogadores e classifica√ß√£o */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1rem;
  }
  th, td {
    padding: 10px 15px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }
  th {
    background-color: #4a90e2;
    color: white;
  }
  /* Responsividade */
  @media (max-width: 640px) {
    .pista {
      width: 90vw;
    }
    #resultado, #apostaResultado {
      max-width: 90vw;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Corrida de Carros com Apostas e Jogadores üèÅ</h1>
</header>

<div class="container">

  <section class="jogadores" aria-label="Adicionar jogadores e apostas">
    <h2>Adicionar Jogador</h2>
    <form id="formJogador" onsubmit="return adicionarJogador();">
      <label for="nomeJogador">Nome:</label>
      <input type="text" id="nomeJogador" required placeholder="Digite o nome" aria-required="true" />
      <label for="apostaJogador">Aposta:</label>
      <select id="apostaJogador" required aria-required="true">
        <option value="" disabled selected>Escolha a cor</option>
        <option value="vermelho">Vermelho</option>
        <option value="azul">Azul</option>
        <option value="verde">Verde</option>
      </select>
      <button type="submit">Adicionar</button>
    </form>
    <p id="msgJogador" role="alert" style="margin-top:10px; font-weight:600;"></p>
  </section>

  <section class="controls" aria-label="Controles da corrida">
    <button onclick="iniciarCorrida()" id="btnIniciar" disabled>Iniciar Corrida</button>
  </section>

  <section aria-label="Pista da corrida" style="margin-bottom: 40px;">
    <div class="pista" id="pistaVermelho" aria-label="Pista Vermelho">
      <div class="carro" id="vermelho" aria-label="Carro Vermelho">
        <div class="farol"></div>
        <div class="janela"></div>
        <div class="roda roda-esq"></div>
        <div class="roda roda-dir"></div>
      </div>
      <div class="linha-chegada" aria-hidden="true"></div>
    </div>
    <div class="pista" id="pistaAzul" aria-label="Pista Azul">
      <div class="carro" id="azul" aria-label="Carro Azul">
        <div class="farol"></div>
        <div class="janela"></div>
        <div class="roda roda-esq"></div>
        <div class="roda roda-dir"></div>
      </div>
      <div class="linha-chegada" aria-hidden="true"></div>
    </div>
    <div class="pista" id="pistaVerde" aria-label="Pista Verde">
      <div class="carro" id="verde" aria-label="Carro Verde">
        <div class="farol"></div>
        <div class="janela"></div>
        <div class="roda roda-esq"></div>
        <div class="roda roda-dir"></div>
      </div>
      <div class="linha-chegada" aria-hidden="true"></div>
    </div>
  </section>

  <p id="resultado" role="status" aria-live="polite"></p>
  <p id="apostaResultado" role="status" aria-live="polite"></p>

  <section class="classificacao" aria-label="Classifica√ß√£o dos jogadores">
    <h2>Classifica√ß√£o</h2>
    <table aria-describedby="classificacaoDescricao">
      <thead>
        <tr>
          <th>Posi√ß√£o</th>
          <th>Jogador</th>
          <th>Apostas Acertadas</th>
          <th>Aposta Atual</th>
        </tr>
      </thead>
      <tbody id="tabelaClassificacao">
        <!-- Linha dos jogadores -->
      </tbody>
    </table>
    <p id="classificacaoDescricao" style="display:none;">
      Esta tabela mostra a classifica√ß√£o dos jogadores com base no n√∫mero de apostas acertadas.
    </p>
  </section>

</div>

<script>
  const distanciaMaxima = 515;
  let corridaFinalizada = false;
  let intervalos = [];

  // Array de jogadores: {nome, aposta, pontos}
  const jogadores = [];

  // Atualiza a tabela de classifica√ß√£o
  function atualizarClassificacao() {
    const tbody = document.getElementById('tabelaClassificacao');
    tbody.innerHTML = '';

    // Ordena por pontos desc, depois por nome
    jogadores.sort((a, b) => b.pontos - a.pontos || a.nome.localeCompare(b.nome));

    jogadores.forEach((jogador, index) => {
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${jogador.nome}</td>
        <td>${jogador.pontos}</td>
        <td>${capitalize(jogador.aposta)}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function capitalize(text) {
    return text.charAt(0).toUpperCase() + text.slice(1);
  }

  // Adiciona um jogador √† lista
  function adicionarJogador() {
    const nomeInput = document.getElementById('nomeJogador');
    const apostaInput = document.getElementById('apostaJogador');
    const msg = document.getElementById('msgJogador');

    const nome = nomeInput.value.trim();
    const aposta = apostaInput.value;

    if (!nome) {
      msg.textContent = 'Por favor, insira um nome v√°lido.';
      msg.style.color = 'crimson';
      return false;
    }
    if (!aposta) {
      msg.textContent = 'Por favor, escolha uma cor para apostar.';
      msg.style.color = 'crimson';
      return false;
    }

    // Evita nomes repetidos
    if (jogadores.some(j => j.nome.toLowerCase() === nome.toLowerCase())) {
      msg.textContent = 'Nome j√° cadastrado.';
      msg.style.color = 'crimson';
      return false;
    }

    jogadores.push({ nome, aposta, pontos: 0 });
    msg.textContent = `Jogador "${nome}" adicionado com aposta "${capitalize(aposta)}".`;
    msg.style.color = 'green';

    nomeInput.value = '';
    apostaInput.selectedIndex = 0;

    atualizarClassificacao();

    // Habilita bot√£o iniciar se houver pelo menos 1 jogador
    document.getElementById('btnIniciar').disabled = jogadores.length === 0;

    return false; // evita submit normal
  }

  // Fun√ß√£o para mover o carro - retorna Promise que resolve o vencedor
  function moverCarro(carroId) {
    const carro = document.getElementById(carroId);
    let posicao = 0;

    return new Promise(resolve => {
      const intervalo = setInterval(() => {
        if (corridaFinalizada) {
          clearInterval(intervalo);
          resolve(null);
          return;
        }
        const passo = Math.floor(Math.random() * 11) + 5;
        posicao += passo;
        if (posicao > distanciaMaxima) posicao = distanciaMaxima;
        carro.style.left = posicao + "px";
        if (posicao >= distanciaMaxima) {
          corridaFinalizada = true;
          clearInterval(intervalo);
          resolve(carroId);
        }
      }, 100);
      intervalos.push(intervalo);
    });
  }

  async function iniciarCorrida() {
    if (jogadores.length === 0) return;

    corridaFinalizada = false;
    document.getElementById('resultado').textContent = "";
    document.getElementById('apostaResultado').textContent = "";

    ['vermelho', 'azul', 'verde'].forEach(id => {
      document.getElementById(id).style.left = '0px';
    });
    intervalos.forEach(i => clearInterval(i));
    intervalos = [];

    // Inicia as corridas
    const promessas = [
      moverCarro('vermelho'),
      moverCarro('azul'),
      moverCarro('verde')
    ];

    const vencedor = await Promise.race(promessas);

    if (vencedor) {
      const nomeCor = capitalize(vencedor);
      document.getElementById('resultado').textContent = `üèÜ ${nomeCor} venceu a corrida!`;

      // Atualiza pontos dos jogadores que acertaram
      let acertaram = [];
      jogadores.forEach(jogador => {
        if (jogador.aposta === vencedor) {
          jogador.pontos++;
          acertaram.push(jogador.nome);
        }
      });

      if (acertaram.length === 1) {
  document.getElementById('apostaResultado').textContent =
    `üéâ Parab√©ns a ${acertaram[0]}! Voc√™ acertou a aposta!`;
  document.getElementById('apostaResultado').style.color = "green";
} else if (acertaram.length > 1) {
  document.getElementById('apostaResultado').textContent =
    `üéâ Parab√©ns a ${acertaram.join(', ')}! Voc√™s acertaram a aposta!`;
  document.getElementById('apostaResultado').style.color = "green";
} else {
  document.getElementById('apostaResultado').textContent =
    "üòû Ningu√©m acertou a aposta dessa vez.";
  document.getElementById('apostaResultado').style.color = "crimson";
}


      atualizarClassificacao();
    } else {
      document.getElementById('resultado').textContent = "Corrida cancelada.";
      document.getElementById('apostaResultado').textContent = "";
    }
  }
</script>

</body>
</html>

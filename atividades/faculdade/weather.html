<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testando API Gratuita</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 24px;
        background-color: #eef1f5; 
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
      }

      .card {
        background-color: #ffffff;
        padding: 25px;
        border-radius: 12px; 
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); 
        max-width: 650px;
        width: 100%; 
        margin: 20px 0;
      }

      h2 {
        color: #1a202c;
        border-bottom: 2px solid #e2e8f0;
        padding-bottom: 10px;
        margin-top: 0;
        font-weight: 600;
      }

      label {
        display: block;
        margin-bottom: 15px;
        color: #4a5568;
        font-weight: 500;
      }

      input[type="text"] {
        padding: 12px 10px;
        margin-top: 5px;
        border-radius: 8px;
        border: 1px solid #cbd5e0;
        width: 100%;
        box-sizing: border-box; 
        transition: border-color 0.3s;
      }

      input[type="text"]:focus {
        border-color: #4299e1;
        outline: none;
        box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
      }

      .units {
        display: flex;
        gap: 20px;
        margin: 10px 0 20px;
        padding: 10px 0;
        border-top: 1px dashed #e2e8f0;
        border-bottom: 1px dashed #e2e8f0;
      }

      .units label {
        display: inline-flex;
        align-items: center;
        cursor: pointer;
        margin-bottom: 0;
        font-weight: normal;
      }

      input[type="radio"] {
        margin-right: 5px;
        transform: scale(1.1);
      }

      button {
        padding: 10px 18px;
        margin-top: 10px;
        border-radius: 8px;
        background-color: #3b82f6; 
        color: #fff;
        border: none;
        cursor: pointer;
        font-weight: 600;
        font-size: 16px;
        transition: background-color 0.3s, transform 0.1s;
        width: 100%; 
      }

      button:hover {
        background-color: #2563eb; 
      }

      button:active {
        transform: scale(0.99);
      }

      .result {
        margin-top: 25px;
        padding: 15px;
        border-radius: 8px;
        line-height: 1.6;
        border-left: 5px solid; 
        background-color: #f7fafc;
        color: #2d3748;
      }
      
      .result h3 {
          margin-top: 0;
          color: #3b82f6;
          font-size: 1.3em;
      }

      .result p strong {
          display: inline-block;
          min-width: 100px;
      }

      .result.error {
        border-left-color: #e53e3e; 
        background-color: #fff5f5;
        color: #9b2c2c;
      }

      .result.warning {
        border-left-color: #dd6b20; 
        background-color: #fffaf0;
        color: #9c4221;
      }
      
      .result.loading {
        border-left-color: #3b82f6;
        background-color: #eff6ff;
        color: #1e40af;
      }

      h4 {
        margin-top: 20px;
        color: #3b82f6;
        font-weight: 600;
      }
      
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 0.95em;
      }

      th, td {
        padding: 10px;
        border: 1px solid #e2e8f0;
        text-align: left;
      }
      
      th:nth-child(2), th:nth-child(3), 
      td:nth-child(2), td:nth-child(3) {
          text-align: center;
          width: 80px; 
      }

      th {
        background-color: #edf2f7; 
        color: #2d3748;
        font-weight: 600;
      }

      tbody tr:nth-child(odd) {
        background-color: #f7fafc;
      }
      
      tbody tr:hover {
          background-color: #ebf8ff;
      }
      
      @media (max-width: 700px) {
          body {
              padding: 15px;
          }
          
          .card {
              margin: 10px 0;
          }
          
          table, thead, tbody, th, td, tr { 
              display: block; 
          }
          
          thead tr { 
              position: absolute;
              top: -9999px;
              left: -9999px;
          }
          
          td {
              border: none;
              border-bottom: 1px solid #eee;
              position: relative;
              padding-left: 50%; /* Espa√ßo para o label */
              text-align: right !important;
          }
          
          td:before {
              content: attr(data-label);
              position: absolute;
              left: 6px;
              width: 45%;
              padding-right: 10px;
              white-space: nowrap;
              text-align: left;
              font-weight: bold;
              color: #4a5568;
          }
          
          td:nth-child(1):before { content: "Dia"; }
          td:nth-child(2):before { content: "M√°xima"; }
          td:nth-child(3):before { content: "M√≠nima"; }
          td:nth-child(4):before { content: "Condi√ß√£o"; }
      }
    </style>
  </head>
<body>
  <main class="card">
    <h2>Pesquisar Local e escolher unidades üîé</h2>
    <form id="form">
      <label>
        Cidade / Localiza√ß√£o:
        <input id="city" name="city" type="text" placeholder="Ex: S√£o Paulo" />
      </label>

      <div class="units" aria-label="Unidades de temperatura">
        <label><input id="chkC" type="radio" name="unit" value="c" checked> Celsius (¬∞C)</label>
        <label><input id="chkF" type="radio" name="unit" value="f"> Fahrenheit (¬∞F)</label>
      </div>

      <button type="submit">Consultar Clima</button>
    </form>

    <div id="output" class="result" hidden></div>
  </main>

  <script>
    const form = document.getElementById('form');
    const output = document.getElementById('output');

    form.addEventListener('submit', async function (ev) {
      ev.preventDefault();

      const city = document.getElementById('city').value.trim();
      const unitInput = document.querySelector('input[name="unit"]:checked');

      // Limpa classes de feedback anteriores
      output.classList.remove('error', 'warning', 'loading');
      
      if (!city) {
        output.hidden = false;
        output.innerHTML = '<strong>Erro:</strong> Informe a cidade para a consulta.';
        output.classList.add('error');
        return;
      }

      if (!unitInput) {
        output.hidden = false;
        output.innerHTML = '<strong>Aten√ß√£o:</strong> Selecione uma unidade de temperatura (C ou F).';
        output.classList.add('warning');
        return;
      }

      const unit = unitInput.value;

      output.hidden = false;
      output.innerHTML = 'Consultando dados... ‚è≥';
      output.classList.add('loading');


      await carregar(city, unit);
    });

    async function carregar(city, unit) {
      // ************* ATEN√á√ÉO: Chave da API exposta. Em produ√ß√£o, use um proxy. *************
      const url = `https://yahoo-weather5.p.rapidapi.com/weather?location=${encodeURIComponent(city)}&format=json&u=${unit}`;
      const options = {
        method: 'GET',
        headers: {
          'x-rapidapi-key': '32a64c624amsh122ea55e0af0d8ap1bd284jsnca5700e2f2eb',
          'x-rapidapi-host': 'yahoo-weather5.p.rapidapi.com'
        }
      };

      try {
        const response = await fetch(url, options);
        if (!response.ok) {
            // Tenta obter mensagem de erro da API, sen√£o usa mensagem gen√©rica
            const errorData = await response.json().catch(() => ({})); 
            const errorMessage = errorData.message || 'Erro ao conectar com a API.';
            throw new Error(errorMessage);
        }
        const data = await response.json();

        formataRetorno(data, unit.toUpperCase());
      } catch (error) {
        output.classList.remove('loading');
        output.classList.add('error');
        output.innerHTML = `<strong>Erro:</strong> ${error.message}`;
        console.error(error);
      }
    }

    function formataRetorno(data, unitSymbol) {
      const loc = data.location;
      const obs = data.current_observation;
      const forecasts = data.forecasts;

      output.classList.remove('loading', 'error', 'warning');
      
      if (!loc || !obs) {
        output.classList.add('warning');
        output.innerHTML = 'N√£o foi poss√≠vel obter dados clim√°ticos para esta localiza√ß√£o.';
        return;
      }
      
      const tempUnit = unitSymbol === 'C' ? 'C' : 'F';
      
      // Adiciona data-label para responsividade da tabela
      const forecastRows = forecasts.map(f => `
        <tr>
          <td data-label="Dia">${f.day}</td>
          <td data-label="M√°xima">${f.high}¬∞${tempUnit}</td>
          <td data-label="M√≠nima">${f.low}¬∞${tempUnit}</td>
          <td data-label="Condi√ß√£o">${f.text}</td>
        </tr>`).join('');


      const html = `
        <h3>Clima atual em ${loc.city}, ${loc.region || loc.country} ‚òÄÔ∏è</h3>
        <p>
          <strong>Temperatura:</strong> ${obs.condition.temperature}¬∞${tempUnit}<br>
          <strong>Condi√ß√£o:</strong> ${obs.condition.text}<br>
          <strong>√öltima atualiza√ß√£o:</strong> ${new Date(obs.pubDate * 1000).toLocaleTimeString('pt-BR')}<br>
          <hr style="border: 0; border-top: 1px dotted #e2e8f0; margin: 10px 0;">
          <strong>Umidade:</strong> ${obs.atmosphere.humidity}%<br>
          <strong>Vento:</strong> ${obs.wind.speed} km/h (${obs.wind.direction})<br>
          <strong>Nascer do sol:</strong> ${obs.astronomy.sunrise}<br>
          <strong>P√¥r do sol:</strong> ${obs.astronomy.sunset}
        </p>

        <h4>Previs√£o para os pr√≥ximos dias:</h4>
        <table>
          <thead>
            <tr>
              <th>Dia</th>
              <th>M√°x</th>
              <th>M√≠n</th>
              <th>Condi√ß√£o</th>
            </tr>
          </thead>
          <tbody>
            ${forecastRows}
          </tbody>
        </table>
      `;

      output.hidden = false;
      output.innerHTML = html;
    }
  </script>
</body>
</html>
